``` sql
-- TEMA 2
-- EX 1
SELECT PR.ORAS, COUNT(DISTINCT R.ID_CLIENT)
FROM PROPRIETATI PR
JOIN (
    SELECT ID_PROPRIETATE, ID_CLIENT
    FROM REZERVARI R2
    WHERE R2.STATUS = 'CONFIRMATA'
) R ON PR.ID_PROPRIETATE = R.ID_PROPRIETATE
JOIN CLIENTI C ON R.ID_CLIENT = C.ID_CLIENT
GROUP BY PR.ORAS;


-- EX 2
SELECT
    C.ID_CLIENT,
    C.NUME
FROM CLIENTI C
JOIN (
    SELECT R.ID_CLIENT
    FROM PLATI P
    JOIN REZERVARI R ON P.ID_REZERVARE = R.ID_REZERVARE
    GROUP BY R.ID_CLIENT
    HAVING COUNT(*) = SUM(CASE WHEN UPPER(P.METODA) LIKE 'CASH' THEN 1 ELSE 0 END)
) CASH_ONLY ON C.ID_CLIENT = CASH_ONLY.ID_CLIENT
JOIN (
    SELECT RV.ID_CLIENT
    FROM REVIEWS RV
    WHERE RV.RATING >= 2
    GROUP BY RV.ID_CLIENT
    HAVING COUNT(*) >= 3
) BUNI ON C.ID_CLIENT = BUNI.ID_CLIENT
GROUP BY C.ID_CLIENT, C.NUME;

-- EX 3
SELECT
    REZULTAT.ID_CLIENT,
    REZULTAT.NUME
FROM (
    SELECT
        CHELTUIELI.ID_CLIENT,
        CHELTUIELI.NUME,
        ROW_NUMBER() OVER (ORDER BY CHELTUIELI.TOTAL_CHELTUIELI DESC) AS RN
    FROM (
        SELECT
            R.ID_CLIENT,
            C.NUME,
            SUM(P.PRET_PER_NOAPTE * (R.DATA_CHECK_OUT - R.DATA_CHECK_IN)) AS TOTAL_CHELTUIELI
        FROM REZERVARI R
        JOIN CLIENTI C ON R.ID_CLIENT = C.ID_CLIENT
        JOIN PROPRIETATI P ON R.ID_PROPRIETATE = P.ID_PROPRIETATE
        GROUP BY R.ID_CLIENT, C.NUME
    ) CHELTUIELI
) REZULTAT
WHERE REZULTAT.RN <= (
    SELECT COUNT(DISTINCT ID_PROPRIETATE)
    FROM REZERVARI
    WHERE EXTRACT(YEAR FROM DATA_CHECK_IN) = 2025
);


```